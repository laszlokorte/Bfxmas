defmodule Example do
  @tree_program "ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸâ˜ƒï¸ğŸ„â˜ƒï¸â˜ƒï¸ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸ„ğŸ…â›„ğŸ¤¶ğŸ„ğŸ…â›„ğŸ¤¶ğŸ„ğŸ…â›„ğŸ¤¶ğŸ„ğŸ…â›„ğŸ¤¶ğŸ„ğŸ…ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²â˜ƒï¸ğŸ„ğŸ„ğŸ„ğŸ„â›„ğŸ¤¶ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸ…ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ…
ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²â˜ƒï¸ğŸ„â˜ƒï¸ğŸ„ğŸ„ğŸ„â›„ğŸ¤¶ğŸŒ²ğŸŒ²ğŸŒ²ğŸ…ğŸ„ğŸ„ğŸ„â˜ƒï¸ğŸŒ²ğŸŒ²ğŸŒ²â›„ğŸ¤¶ğŸŒ²ğŸ…ğŸ„â˜ƒï¸ğŸŒ²ğŸŒ²â›„ğŸ…ğŸ„ğŸ„ğŸ…â›„ğŸ¤¶ğŸ„â˜ƒï¸ğŸŒ²ğŸŒ²ğŸŒ²â›„ğŸ¤¶ğŸ„ğŸ„ğŸ„ğŸ…ğŸŒ²ğŸŒ²ğŸŒ²â˜ƒï¸ğŸ„ğŸ„
ğŸ„â›„ğŸ¤¶ğŸŒ²ğŸ…ğŸŒ²â›„ğŸ…ğŸ„ğŸ„ğŸ„â›„ğŸŒ²ğŸŒ²ğŸŒ²ğŸ…â›„ğŸ¤¶ğŸ¤¶â˜ƒï¸ğŸ„â›„ğŸ¤¶ğŸŒ²â›„ğŸ¤¶ğŸ„ğŸ„ğŸ„â˜ƒï¸ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸ¤¶ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„â˜ƒï¸ğŸŒ²ğŸŒ²ğŸ„ğŸ„ğŸ„â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸ğŸ…
ğŸ„â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸ğŸŒ²â›„ğŸ¤¶ğŸ„â›„â›„â›„ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸ„ğŸ„ğŸ„â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸ğŸ…ğŸ„ğŸ„â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸ğŸŒ²ğŸŒ²â›„ğŸ¤¶ğŸŒ²ğŸŒ²ğŸŒ²ğŸ„ğŸ„ğŸ„â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸â˜ƒï¸
ğŸŒ²ğŸŒ²ğŸŒ²ğŸ…â›„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„â˜ƒï¸ğŸ„â˜ƒï¸ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„â˜ƒï¸ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸ¤¶ğŸ„ğŸ„ğŸ…â›„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„â˜ƒï¸ğŸŒ²ğŸŒ²
ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸ¤¶ğŸ„ğŸ„ğŸ„ğŸ„â˜ƒï¸ğŸ…ğŸ„ğŸ…â›„ğŸ„â˜ƒï¸ğŸ„ğŸ„ğŸ„â˜ƒï¸ğŸ„ğŸ„â˜ƒï¸ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸ¤¶ğŸ„ğŸ„ğŸ…â›„ğŸ„â˜ƒï¸ğŸ„ğŸ„â˜ƒï¸ğŸŒ²ğŸŒ²ğŸŒ²ğŸ¤¶ğŸ„ğŸ„ğŸ…â›„ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²
ğŸ””ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ¤¶ğŸ„ğŸ…â›„ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸ””ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ¤¶ğŸ„ğŸ…â›„ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸ””ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ¤¶ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²
ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸ””ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸ…â›„ğŸŒ²â˜ƒï¸ğŸ„ğŸ¤¶ğŸŒ²â›„ğŸ„ğŸ„ğŸ„ğŸ…â›„ğŸŒ²â˜ƒï¸ğŸ„ğŸ¤¶ğŸŒ²â˜ƒï¸â˜ƒï¸ğŸŒ²ğŸŒ²ğŸŒ²â›„ğŸ¤¶ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„
ğŸ„ğŸ„â›„ğŸ…ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸ””ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„â›„ğŸ¤¶ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸ””ğŸ””ğŸ””"

  def run_tree do
    io = self()
    spawn(fn -> Bfxmas.exec(@tree_program, io); end)

    io_loop(:char)
  end

  def run_own do
    io = self()
    spawn(fn -> Bfxmas.exec(IO.gets("Enter a program:\n"), io); end)
    io_loop(:num)
  end

  def io_loop(output_type) do
    receive do
      {:print, num} -> output(output_type, num); io_loop(output_type)
      {:read, back} -> send(back, {:num, read_number()}); io_loop(output_type)
      {:finish, tape} -> tape
    end
  end

  def output(:char, num) do
    IO.write(List.to_string([num]))
  end

  def output(:num, num) do
    IO.write(num) 
  end

  def read_number do
    Integer.parse(IO.gets("Enter a Number (n >= 2):\n\n"), 10)
    |> case do
      {n, "\n"} when n > 1 -> n
      _ -> read_number()
    end
  end
end